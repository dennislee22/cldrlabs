<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Add ECS Node</title>
    <link
      rel="stylesheet"
      href="/assets/css/style.css"
    />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link
      rel="stylesheet"
      href="/assets/css/rouge.css"
    />
    <script src="/assets/js/accordian.js"></script>
    <script src="/assets/js/heading_links.js"></script>
    
    <script src="/assets/js/vendor/lunr.min.js"></script>
    <script src="/assets/js/search.js"></script>
    
  </head>

  <body>
    <div class="chrome">
      <div class="chrome:nav">
      <img src="/assets/images/cloudera_logo_WHITE.png" alt="Link to GitHub Repository">
  
</div>

      <div class="chrome:body">
        <header class="chrome:header">
  <div class="chrome:header_title">
    <a href="/" class="text-grey-800 no-underline hover:no-underline focus:no-underline">
      <span class="text-3xl">Cloudera Labs</span>
    </a>
  </div>
   <div class="chrome:header_item">
  <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" focusable="false" viewBox="0 0 26 26">
  <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2">
    <circle cx="11" cy="11" r="7"/>
    <path d="M16 16l6 6"/>
  </g>
</svg>

  <form id="search">
    <input
      type="text"
      id="search_input"
      name="search_query"
      class="search_input"
      placeholder="Search Cloudera Labs"
      autocomplete="off"
    />
  </form>
</div>
 
</header>

        <div class="chrome:content">
          <div class="chrome:main">
            
            
            <h1 id="add-ecs-node">Add ECS Node</h1>
            
            
            
<p>This article explains the steps to add a new ECS node (ecsworker3.cdpkvm.cldr) into the existing CDP PvC ECS cluster. Please note that this activity will need to restart the entire ECS cluster including the ECS master/server node. Service disruption is expected.
This is only applicable to CDP Private Cloud solution installed with ECS system.</p>

<hr />

<ol>
  <li>
    <p>In CM, navigate to <code class="language-plaintext highlighter-rouge">Clusters</code> &gt; <code class="language-plaintext highlighter-rouge">ECS</code> &gt; <code class="language-plaintext highlighter-rouge">Storage UI</code> to launch the Longhorn dashboard.</p>

    <p><img src="../../assets/images/ecs/expandecs1.png" alt="" /></p>
  </li>
  <li>
    <p>In Longhorn dashboard, take note that there is only 3 Longhorn nodes currently.</p>

    <p><img src="../../assets/images/ecs/expandecs2.png" alt="" /></p>

    <p>Check that the ECS cluster has 3 nodes currently.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># kubectl get nodes</span>
 NAME                     STATUS   ROLES                       AGE     VERSION
 ecsmaster1.cdpkvm.cldr   Ready    control-plane,etcd,master   4d13h   v1.21.8+rke2r2
 ecsworker1.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
 ecsworker2.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
</code></pre></div>    </div>
  </li>
  <li>
    <p>In CM, navigate to <code class="language-plaintext highlighter-rouge">Clusters</code> &gt; <code class="language-plaintext highlighter-rouge">ECS 1</code>. Click <code class="language-plaintext highlighter-rouge">3 Hosts</code> to view the following page. Click <code class="language-plaintext highlighter-rouge">Add Hosts</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs3.png" alt="" /></p>
  </li>
  <li>
    <p>Select <code class="language-plaintext highlighter-rouge">ECS 1</code> cluster as follows. Click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs4.png" alt="" /></p>
  </li>
  <li>
    <p>Enter the FQDN of the ECS node and click <code class="language-plaintext highlighter-rouge">Search</code>. Upon successful scan, the hostname alongside each hostâ€™s IP address will appear. Check the details before clicking <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs5.png" alt="" /></p>
  </li>
  <li>
    <p>Click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs6.png" alt="" /></p>
  </li>
  <li>
    <p>Ensure that JDK has already been installed in the ECS host. Select <code class="language-plaintext highlighter-rouge">Manually manage JDK</code> and click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs7.png" alt="" /></p>
  </li>
  <li>
    <p>Enter the login credentials. Click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs8.png" alt="" /></p>
  </li>
  <li>
    <p>CM is installing the agent in the ECS node and will subsequently install the parcels.</p>

    <p><img src="../../assets/images/ecs/expandecs9.png" alt="" /></p>
  </li>
  <li>
    <p>Check the results if needed. Otherwise, click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs10.png" alt="" /></p>
  </li>
  <li>
    <p>Click <code class="language-plaintext highlighter-rouge">Create...</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs11.png" alt="" /></p>
  </li>
  <li>
    <p>Fill in the <code class="language-plaintext highlighter-rouge">Template Name</code> and select the role groups for this ECS worker/agent node.</p>

    <p><img src="../../assets/images/ecs/expandecs12.png" alt="" /></p>
  </li>
  <li>
    <p>Verify the details and click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs13.png" alt="" /></p>
  </li>
  <li>
    <p>Upon successful deployment, click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs14.png" alt="" /></p>
  </li>
  <li>
    <p>Click <code class="language-plaintext highlighter-rouge">Finish</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs15.png" alt="" /></p>
  </li>
  <li>
    <p>Note that the new ECS worker/agent node has been added successfully.</p>

    <p><img src="../../assets/images/ecs/expandecs16.png" alt="" /></p>

    <p>The ECS cluster is now updated with the new node.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kubectl get nodes</span>
NAME                     STATUS   ROLES                       AGE     VERSION
ecsmaster1.cdpkvm.cldr   Ready    control-plane,etcd,master   4d13h   v1.21.8+rke2r2
ecsworker1.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker2.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker3.cdpkvm.cldr   Ready    &lt;none&gt;                      111s    v1.21.8+rke2r2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Navigate to <code class="language-plaintext highlighter-rouge">Clusters</code> &gt; <code class="language-plaintext highlighter-rouge">ECS 1</code>. Click the orange button to restart the ECS cluster.</p>

    <p><img src="../../assets/images/ecs/expandecs17.png" alt="" /></p>
  </li>
  <li>
    <p>Click <code class="language-plaintext highlighter-rouge">Restart Stale Services</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs18.png" alt="" /></p>
  </li>
  <li>
    <p>Select <code class="language-plaintext highlighter-rouge">Re-deploy client configuration</code> and subsequently click <code class="language-plaintext highlighter-rouge">Restart Now</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs19.png" alt="" /></p>

    <p>This will restart the entire ECS cluster. During this process, the nodes will be reflected as <code class="language-plaintext highlighter-rouge">NotReady</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kubectl get nodes</span>
NAME                     STATUS     ROLES                       AGE     VERSION
ecsmaster1.cdpkvm.cldr   NotReady   control-plane,etcd,master   4d13h   v1.21.8+rke2r2
ecsworker1.cdpkvm.cldr   NotReady   &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker2.cdpkvm.cldr   NotReady   &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker3.cdpkvm.cldr   NotReady   &lt;none&gt;                      11m     v1.21.8+rke2r2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Upon successful restart, click <code class="language-plaintext highlighter-rouge">Continue</code>.</p>

    <p><img src="../../assets/images/ecs/expandecs20.png" alt="" /></p>
  </li>
  <li>
    <p>The Longhorn dashboard now displays a total of 4 Longhorn nodes. This implies that the new ECS node has been added into the Longhorn cluster successfully.</p>

    <p><img src="../../assets/images/ecs/expandecs21.png" alt="" /></p>

    <p>All ECS nodes should be in <code class="language-plaintext highlighter-rouge">Ready</code> mode.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kubectl get nodes</span>
NAME                     STATUS   ROLES                       AGE     VERSION
ecsmaster1.cdpkvm.cldr   Ready    control-plane,etcd,master   4d14h   v1.21.8+rke2r2
ecsworker1.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker2.cdpkvm.cldr   Ready    &lt;none&gt;                      4d13h   v1.21.8+rke2r2
ecsworker3.cdpkvm.cldr   Ready    &lt;none&gt;                      14m     v1.21.8+rke2r2
</code></pre></div>    </div>
  </li>
  <li>
    <p>The storage is now currently empty for this newly added node.</p>

    <p><img src="../../assets/images/ecs/expandecs22.png" alt="" /></p>
  </li>
  <li>
    <p>In CM, ensure that new node is in green mode with the correct roles provisioned.</p>

    <p><img src="../../assets/images/ecs/expandecs23.png" alt="" /></p>
  </li>
  <li>
    <p>Create a new environment in the CDP Data Services Management Console. After successful creation of the environment, the system might choose this new node to provision the storage. If so, the longhorn dashboard will show that some space has been provisioned in this newly added node.</p>

    <p><img src="../../assets/images/ecs/expandecs24.png" alt="" /></p>

    <p>Verify that the system has provisioned some volumes at this new node in the <code class="language-plaintext highlighter-rouge">/longhorn</code>directory which was specified during the initial ECS cluster installation.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tree /longhorn</span>
/longhorn
<span class="sb">`</span><span class="nt">--</span> ecs
    <span class="sb">`</span><span class="nt">--</span> longhorn-storage
        |-- longhorn-disk.cfg
        <span class="sb">`</span><span class="nt">--</span> replicas
            |-- pvc-40338fdb-c0dd-4e0d-a634-d3e8263a46e6-bbcad0e4
            |   |-- revision.counter
            |   |-- volume-head-000.img
            |   |-- volume-head-000.img.meta
            |   <span class="sb">`</span><span class="nt">--</span> volume.meta
            |-- pvc-6709bacb-db5e-4129-8f9e-c645e07ad921-16dcd615
            |   |-- revision.counter
            |   |-- volume-head-000.img
            |   |-- volume-head-000.img.meta
            |   <span class="sb">`</span><span class="nt">--</span> volume.meta
            |-- pvc-bc1e2346-d9d8-4ff6-be00-4105a6b8f433-ae9b50e3
            |   |-- revision.counter
            |   |-- volume-head-000.img
            |   |-- volume-head-000.img.meta
            |   <span class="sb">`</span><span class="nt">--</span> volume.meta
            |-- pvc-cd6d226b-075a-475c-b5b3-9b79961bc338-8224c2de
            |   |-- revision.counter
            |   |-- volume-head-000.img
            |   |-- volume-head-000.img.meta
            |   <span class="sb">`</span><span class="nt">--</span> volume.meta
            <span class="sb">`</span><span class="nt">--</span> pvc-d37b564f-8d77-4cc0-b634-b85c0d1bca91-cf49bf98
                |-- revision.counter
                |-- volume-head-000.img
                |-- volume-head-000.img.meta
                <span class="sb">`</span><span class="nt">--</span> volume.meta
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a new Impala database at the CDW console. The system might choose to provision the CDW pods and its persistent volume in this new node. If so, the direct attached local disk with the <code class="language-plaintext highlighter-rouge">localpath</code> mountpoint will be provisioned with the impala cache file as shown below. The <code class="language-plaintext highlighter-rouge">localpath</code> directory was configured during the initial ECS cluster installation.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tree /localpath/</span>
/localpath/
<span class="sb">`</span><span class="nt">--</span> local-storage
    <span class="sb">`</span><span class="nt">--</span> pvc-a8c1086a-e7e3-4cf2-af02-da0a17ab146b_impala-1653548482-kwb7_scratch-cache-volume-impala-executor-000-0
        |-- impala-cache-file-b94f4c649f4d8adc:5ac6c6fd6c847ba3
        <span class="sb">`</span><span class="nt">--</span> impala-scratch

3 directories, 1 file
</code></pre></div>    </div>
  </li>
</ol>

            
          </div>
           <div class="chrome:sidebar">
  
    
      
      
      
      <button
        id="sidebar_item:ansible foundry"
        class="chrome:sidebar_item chrome:sidebar_item_collapsible chrome:sidebar_item_collapsed"
        onclick="toggleAccordian('sidebar_item:ansible foundry')"
      >
        <span class="chrome:sidebar_item_text">Ansible Foundry</span>
        <div class="chrome:collapsible_sub_nav_item_icon">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="12"
    height="12"
    viewBox="0 0 12 12"
    focusable="false"
    role="presentation"
  >
    <path
      fill="currentColor"
      d="M1.646 3.646a.5.5 0 01.638-.057l.07.057L6 7.293l3.646-3.647a.5.5 0 01.638-.057l.07.057a.5.5 0 01.057.638l-.057.07-4 4a.5.5 0 01-.638.057l-.07-.057-4-4a.5.5 0 010-.708z"
    ></path>
  </svg>
</div>

      </button>
      <div id="sidebar_item:ansible foundry:accordian"
        class="chrome:sidebar_item_accordian chrome:sidebar_item_accordian_collapsed">
        
          
          
          
          <a href="/docs/content/ansible_intro/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            Introduction
          </a>
          
        
          
          
          
          <a href="/docs/content/ansible_developers/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            Goal-oriented Guides
          </a>
          
        
          
          
          
          <a href="/docs/content/ansible_info/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            References
          </a>
          
        
          
          
          
          <a href="/docs/content/ansible_troubleshoot/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            Operations
          </a>
          
        
      </div>
    
  
    
      
      
      
      <button
        id="sidebar_item:cdp pvc data services"
        class="chrome:sidebar_item chrome:sidebar_item_collapsible chrome:sidebar_item_expanded"
        onclick="toggleAccordian('sidebar_item:cdp pvc data services')"
      >
        <span class="chrome:sidebar_item_text">CDP PvC Data Services</span>
        <div class="chrome:collapsible_sub_nav_item_icon">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="12"
    height="12"
    viewBox="0 0 12 12"
    focusable="false"
    role="presentation"
  >
    <path
      fill="currentColor"
      d="M1.646 3.646a.5.5 0 01.638-.057l.07.057L6 7.293l3.646-3.647a.5.5 0 01.638-.057l.07.057a.5.5 0 01.057.638l-.057.07-4 4a.5.5 0 01-.638.057l-.07-.057-4-4a.5.5 0 010-.708z"
    ></path>
  </svg>
</div>

      </button>
      <div id="sidebar_item:cdp pvc data services:accordian"
        class="chrome:sidebar_item_accordian chrome:sidebar_item_accordian_expanded">
        
          
          
          
          <a href="/docs/content/ecs_env/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            ECS: Client
          </a>
          
        
          
          
          
          <a href="/docs/content/ecs_lvm/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            ECS: LVM
          </a>
          
        
          
          
          
          <a href="/docs/content/ecs_gpu/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            ECS: GPU
          </a>
          
        
          
          
          
          <a href="/docs/content/ecs_addnode/" class="chrome:sidebar_item text-sm chrome:active_sidebar_item chrome:sidebar_item_child">
            ECS: Add ECS Node
          </a>
          
        
          
          
          
          <a href="/docs/content/ecs_removenode/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            ECS: Remove Node
          </a>
          
        
          
          
          
          <a href="/docs/content/ocp_gpu/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            OCP: GPU
          </a>
          
        
          
          
          
          <a href="/docs/content/ocp_cdwdisk/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            OCP: CDW Disk
          </a>
          
        
          
          
          
          <a href="/docs/content/cml_autotls/" class="chrome:sidebar_item text-sm  chrome:sidebar_item_child">
            CML: CSR with AutoTLS
          </a>
          
        
      </div>
    
  
    
      
      
      
      <a href="/docs/development/" class="chrome:sidebar_item ">
        <span class="chrome:sidebar_item_text">Coming Soon</span>
      </a>
      
    
  
</div>
 
        </div>
        <footer class="chrome:footer"><div class="chrome:footer_item">
    <span class="text-lg"
      >Updated: 2022-11-21 15:51</span
    >
  </div>
</footer>

      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        let theme = "forest";
        mermaid.initialize({ startOnLoad: true, theme });
        window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    </script>
    
  </body>
</html>
